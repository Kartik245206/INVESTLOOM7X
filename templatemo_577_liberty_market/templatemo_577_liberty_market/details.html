<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Product Details - InvestLoom7x</title>
    
    <!-- CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/fontawesome.css" rel="stylesheet">
    <link href="assets/css/templatemo-liberty-market.css" rel="stylesheet">
    <link href="assets/css/owl.css" rel="stylesheet">
    <link href="assets/css/animate.css" rel="stylesheet">
    <link href="https://unpkg.com/swiper@7/swiper-bundle.min.css" rel="stylesheet">
</head>
<body>
    <!-- ***** Preloader Start ***** -->
    <div id="js-preloader" class="js-preloader">
        <div class="preloader-inner">
            <span class="dot"></span>
            <div class="dots"><span></span><span></span><span></span></div>
        </div>
    </div>
    <!-- ***** Preloader End ***** -->

    <!-- ***** Header Area Start ***** -->
    <!-- Copy your header from index.html -->
    <!-- ***** Header Area End ***** -->

    <div class="page-heading normal-space">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h6>InvestLoom7x Market</h6>
                    <h2>View Investment Details</h2>
                    <span>Home > <a href="#">Product Details</a></span>
                </div>
            </div>
        </div>
    </div>

    <div class="item-details-page">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-heading">
                        <div class="line-dec"></div>
                        <h2>View <em>Product Details</em> Here.</h2>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="left-image">
                        <img src="" alt="" id="productImage">
                    </div>
                </div>
                <div class="col-lg-5 align-self-center">
                    <h4 id="productName"></h4>
                    <span class="author">
                        <h6>Investment Plan: <em id="productPlan"></em></h6>
                    </span>
                    <div class="line-dec"></div>
                    <div class="row">
                        <div class="col-6">
                            <span class="bid">
                                Daily Returns<br><strong id="productPrice">₹0/day</strong>
                            </span>
                        </div>
                        <div class="col-6">
                            <span class="bid">
                                Total Returns<br><strong id="productTotal">₹0</strong>
                            </span>
                        </div>
                    </div>
                    <p id="productDescription" class="mt-4"></p>
                    
                    <!-- Purchase Button -->
                    <div class="buttons">
                        <div class="main-button">
                            <a href="#" onclick="purchaseProduct(); return false;">Purchase Now</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/custom.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Get product ID from URL
            const productId = window.location.pathname.split('/').pop();
            
            try {
                // Fetch product details from API
                const response = await fetch(`/api/products/${productId}`);
                const product = await response.json();
                
                if (!product) {
                    alert('Product not found');
                    window.location.href = '/';
                    return;
                }

                // Update UI with product details
                document.getElementById('productImage').src = product.image;
                document.getElementById('productName').textContent = product.name;
                document.getElementById('productPlan').textContent = product.Plans;
                document.getElementById('productPrice').textContent = `₹${product.price}/day`;
                document.getElementById('productTotal').textContent = `₹${product.total}`;
                document.getElementById('productDescription').textContent = product.description;
                
            } catch (error) {
                console.error('Error loading product:', error);
                alert('Failed to load product details');
            }
        });

        async function purchaseProduct() {
            const productId = window.location.pathname.split('/').pop();
            
            try {
                // Check if user is logged in
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login to purchase');
                    window.location.href = '/login';
                    return;
                }

                // Make purchase API call
                const response = await fetch('/api/purchase', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ productId })
                });

                const result = await response.json();

                if (result.success) {
                    alert('Purchase successful!');
                    window.location.href = '/profile';
                } else {
                    alert(result.error || 'Purchase failed');
                }
            } catch (error) {
                console.error('Purchase error:', error);
                alert('Purchase failed. Please try again.');
            }
        }
    </script>
</body>
</html>

