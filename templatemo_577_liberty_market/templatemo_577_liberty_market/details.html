<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Product Details - InvestLoom7x</title>
    <!-- Core CSS -->
    <link href="assets/css/utils/variables.css" rel="stylesheet">
    <link href="assets/css/main.css" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/fontawesome.css" rel="stylesheet">
    <link href="assets/css/templatemo-liberty-market.css" rel="stylesheet">
    <link href="assets/css/owl.css" rel="stylesheet">
    <link href="assets/css/navigation.css" rel="stylesheet">
    <link href="assets/css/utils/animations.css" rel="stylesheet">
    <link href="assets/css/utils/animate.css" rel="stylesheet">
    <link href="assets/css/utils/responsive.css" rel="stylesheet">
    <link href="https://unpkg.com/swiper@7/swiper-bundle.min.css" rel="stylesheet">
    <script src="assets/js/navigation.js" defer></script>
    <link href="assets/css/pages/dashboard.css" rel="stylesheet">
    <script src="assets/js/auth.js" defer></script>
    <script src="assets/js/main.js" defer></script>
    <script>
    // load [footer-nav.html](http://_vscodecontentref_/1) and insert it into the page (execute inline scripts)
    (function loadFooterNav() {
      fetch('common/footer-nav.html')
        .then(r => {
          if (!r.ok) throw new Error('HTTP ' + r.status);
          return r.text();
        })
        .then(html => {
          const container = document.createElement('div');
          container.innerHTML = html;

          // Move non-script nodes into body (append at end)
          const scripts = [];
          Array.from(container.childNodes).forEach(node => {
            if (node.tagName === 'SCRIPT') scripts.push(node);
            else document.body.appendChild(node);
          });

          // Recreate & run scripts (so inline scripts execute)
          scripts.forEach(oldScript => {
            const s = document.createElement('script');
            if (oldScript.src) s.src = oldScript.src;
            s.textContent = oldScript.textContent;
            // preserve async/defer attributes if present
            if (oldScript.async) s.async = true;
            if (oldScript.defer) s.defer = true;
            document.body.appendChild(s);
          });
        })
        .catch(err => console.error('Could not load footer-nav:', err));
    })();
    </script>
</head>


<body>
    
    <header class="main-nav">
        <a href="index.html" class="logo">
            <img src="assets/images/logo.png" alt="INVESTLOOM7X">
        </a>
        
        <nav class="nav-menu" id="mainNavMenu">
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a></li>
                <li><a href="profile.html" class="nav-link">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a></li>
                <li><a href="details.html" class="nav-link">
                    <i class="fas fa-info-circle"></i>
                    <span>Details</span>
                </a></li>
                <li><a href="Host-WEB/admin_Login_page.html" class="nav-link">
                    <i class="fas fa-user-shield"></i>
                    <span>Admin</span>
                </a></li>
                <li><a href="login.html" class="nav-link">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Login</span>
                </a></li>
                <li><a href="signup.html" class="nav-link">
                    <i class="fas fa-user-plus"></i>
                    <span>Sign Up</span>
                </a></li>
            </ul>
        </nav>
        
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <!-- ***** Preloader Start ***** -->
    <div id="js-preloader" class="js-preloader">
        <div class="preloader-inner">
            <span class="dot"></span>
            <div class="dots"><span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>
    

    <div class="item-details-page">
        <div class="container">
            <div class="row">
                <div class="col-4 col-md-4 col-lg-3 mb-3">
                    <div class="left-image">
                        <img src="" alt="" id="productImage">
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="product-details">
                        <h2 id="productName"></h2>
                        <div class="plan-type">
                            <span id="productPlan"></span>
                        </div>
                        <div class="price-info">
                            <div class="daily-return">
                                <span>Daily Return</span>
                                <h3 id="productPrice"></h3>
                            </div>
                            <div class="total-return">
                                <span>Total Return</span>
                                <h3 id="productTotal"></h3>
                            </div>
                        </div>
                        <div class="duration">
                            <span>Duration</span>
                            <h4>100 Days</h4>
                        </div>
                        <div class="purchase-button">
                            <button id="purchaseButton" class="main-button">Purchase Now</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/custom.js"></script>
    
    <script>
    // Navigation Script
    document.addEventListener('DOMContentLoaded', function() {
        const sideNav = document.querySelector('.side-nav');
        const navHandle = document.getElementById('navHandle');
        const sideNavOverlay = document.getElementById('sideNavOverlay');
        const navIcon = navHandle.querySelector('i');

        // Function to toggle side nav
        function toggleSideNav(forceClose = false) {
            const isActive = sideNav.classList.contains('active');

            if (forceClose || isActive) {
                sideNav.classList.remove('active');
                sideNavOverlay.classList.remove('active');
                navHandle.classList.remove('active');
                sideNavOverlay.style.display = 'none';
                navIcon.classList.remove('fa-times');
                navIcon.classList.add('fa-bars');
            } else {
                sideNav.classList.add('active');
                sideNavOverlay.classList.add('active');
                navHandle.classList.add('active');
                sideNavOverlay.style.display = 'block';
                navIcon.classList.remove('fa-bars');
                navIcon.classList.add('fa-times');
            }
        }

        // Click on toggle button
        navHandle.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleSideNav();
        });

        // Click on overlay to close
        sideNavOverlay.addEventListener('click', () => {
            toggleSideNav(true);
        });

        // Close nav when clicking outside
        document.addEventListener('click', (e) => {
            if (!sideNav.contains(e.target) && !navHandle.contains(e.target)) {
                toggleSideNav(true);
            }
        });

        // Add active class to current page link
        const currentPage = window.location.pathname.split('/').pop();
        document.querySelectorAll('.side-nav .nav-link').forEach(link => {
            const href = link.getAttribute('href');
            if (href === currentPage || (currentPage === '' && href === 'index.html')) {
                link.classList.add('active');
            }
        });

        // Get product ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        
        if (!productId) {
            alert('Product not found');
            window.location.href = 'index.html';
            return;
        }

        // Get products from localStorage
        const products = JSON.parse(localStorage.getItem('products') || '[]');
        const product = products.find(p => p.id == productId);

        if (!product) {
            alert('Product not found');
            window.location.href = 'index.html';
            return;
        }

        // Update UI with product details
        document.getElementById('productImage').src = product.image;
        document.getElementById('productName').textContent = product.name;
        document.getElementById('productPlan').textContent = product.Plans;
        document.getElementById('productPrice').textContent = `₹${product.price}/day`;
        document.getElementById('productTotal').textContent = `₹${product.total}`;

        // Add click handler for purchase button
        document.getElementById('purchaseButton').addEventListener('click', purchaseProduct);
    });

    async function purchaseProduct() {
        try {
            // Check if user is logged in
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                alert('Please login to purchase');
                window.location.href = 'login.html';
                return;
            }

            // Get product details
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const product = products.find(p => p.id == productId);

            if (!product) {
                alert('Product not found');
                return;
            }

            // Show notice modal before payment
            showNoticeModal(product, currentUser);

        } catch (error) {
            console.error('Purchase error:', error);
            alert(error.message || 'Purchase failed. Please try again.');
        }
    }

    function showNoticeModal(product, user) {
        const noticeHTML = `
        <div class="modal fade" id="noticeModal">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-warning">
                        <h5 class="modal-title text-dark">⚠️ Important Notice</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="notice-content">
                            <h6 class="text-danger mb-3">Please Read Carefully</h6>
                            
                            <div class="notice-points">
                                <p>1. This is a competitive investment product where you'll be matched with another user.</p>
                                
                                <p>2. Only TWO users can participate in this battle for returns.</p>
                                
                                <p>3. The winning conditions are:</p>
                                <ul>
                                    <li>Higher deposit amount than opponent</li>
                                    <li>Longer survival in the investment period</li>
                                    <li>Active daily check-ins</li>
                                </ul>
                                
                                <p>4. The winning user will receive:</p>
                                <ul>
                                    <li>Original investment amount</li>
                                    <li>Additional 25% bonus returns</li>
                                    <li>Opponent's forfeited amount (if they quit early)</li>
                                </ul>

                                <p class="text-danger">5. WARNING: Early withdrawal will result in:</p>
                                <ul class="text-danger">
                                    <li>Immediate forfeit of invested amount</li>
                                    <li>Transfer of benefits to opponent</li>
                                    <li>Account penalty for 7 days</li>
                                </ul>
                            </div>

                            <div class="mt-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="agreeCheck">
                                    <label class="form-check-label" for="agreeCheck">
                                        I understand and agree to these competitive terms
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button onclick="handleAgreement()" id="continueBtn" class="btn btn-primary" disabled>
                            Agree & Continue
                        </button>
                    </div>
                </div>
            </div>
        </div>`;

        // Add modal to body
        document.body.insertAdjacentHTML('beforeend', noticeHTML);
        
        // Show modal
        const noticeModal = new bootstrap.Modal(document.getElementById('noticeModal'));
        noticeModal.show();

        // Handle checkbox
        document.getElementById('agreeCheck').addEventListener('change', function(e) {
            document.getElementById('continueBtn').disabled = !e.target.checked;
        });
    }

    function handleAgreement() {
        // Close notice modal
        bootstrap.Modal.getInstance(document.getElementById('noticeModal')).hide();
        
        // Get current product and user
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const products = JSON.parse(localStorage.getItem('products') || '[]');
        const product = products.find(p => p.id == productId);
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));

        // Show payment modal
        showPaymentModal(product, currentUser);
    }

    function showPaymentModal(product, user) {
        const modalHTML = `
        <div class="modal fade" id="paymentModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Select Payment Method</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="payment-methods">
                            <button class="payment-method-btn active" onclick="selectPaymentMethod('upi')">
                                <img src="assets/images/upi-icon.png" alt="UPI">
                                <span>UPI Payment</span>
                            </button>
                            <div class="upi-apps mt-3">
                                <h6>Select UPI App</h6>
                                <div class="upi-app-list">
                                    <button onclick="initiateUPIPayment('gpay')">
                                        <img src="assets/images/gpay.png" alt="Google Pay">
                                    </button>
                                    <button onclick="initiateUPIPayment('phonepe')">
                                        <img src="assets/images/phonepe.png" alt="PhonePe">
                                    </button>
                                    <button onclick="initiateUPIPayment('paytm')">
                                        <img src="assets/images/paytm.png" alt="Paytm">
                                    </button>
                                </div>
                            </div>
                            <div class="payment-details mt-4">
                                <div class="amount-details">
                                    <h6>Payment Details</h6>
                                    <p>Amount: ₹${product.total}</p>
                                    <p>UPI ID: ${user.upiId || 'Please update UPI ID in profile'}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>`;

        // Add modal to body
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Show modal
        const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
        paymentModal.show();
    }

    function initiateUPIPayment(app) {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const products = JSON.parse(localStorage.getItem('products') || '[]');
        const product = products.find(p => p.id == productId);

        // UPI deep linking
        const upiURL = {
            gpay: `upi://pay?pa=${currentUser.upiId}&pn=${currentUser.username}&am=${product.total}&cu=INR&tn=INVESTLOOM7X-${productId}`,
            phonepe: `phonepe://pay?pa=${currentUser.upiId}&pn=${currentUser.username}&am=${product.total}&cu=INR&tn=INVESTLOOM7X-${productId}`,
            paytm: `paytmmp://pay?pa=${currentUser.upiId}&pn=${currentUser.username}&am=${product.total}&cu=INR&tn=INVESTLOOM7X-${productId}`
        };

        // Open UPI app
        window.location.href = upiURL[app];

        // Listen for payment status
        checkPaymentStatus(product);
    }

    function checkPaymentStatus(product) {
        // Show payment processing modal
        const processingModal = `
        <div class="modal fade" id="processingModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body text-center">
                        <div class="spinner-border text-primary mb-3"></div>
                        <h5>Processing Payment</h5>
                        <p>Please complete the payment in your UPI app</p>
                        <button onclick="confirmPayment('${product.id}')" class="btn btn-primary mt-3">
                            I have completed the payment
                        </button>
                    </div>
                </div>
            </div>
        </div>`;

        document.body.insertAdjacentHTML('beforeend', processingModal);
        new bootstrap.Modal(document.getElementById('processingModal')).show();
    }
    </script>

    <style>
    .item-details-page {
        padding: 120px 0 60px;
        background: #1d1d1d;
    }

    .product-details {
        padding: 30px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .left-image img {
        width: 100%;
        border-radius: 20px;
        margin-bottom: 30px;
    }

    .product-details h2 {
        color: #fff;
        margin-bottom: 20px;
    }

    .plan-type span {
        background: #7453fc;
        color: #fff;
        padding: 8px 20px;
        border-radius: 25px;
        display: inline-block;
        margin-bottom: 25px;
    }

    .price-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 25px;
    }

    .price-info > div {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 15px;
    }

    .price-info span {
        color: #b4b2ba;
        display: block;
        margin-bottom: 5px;
    }

    .price-info h3 {
        color: #7453fc;
        font-size: 24px;
        margin: 0;
    }

    .duration {
        margin-bottom: 30px;
    }

    .duration span {
        color: #b4b2ba;
    }

    .duration h4 {
        color: #fff;
        margin: 5px 0 0;
    }

    .main-button {
        background: #7453fc;
        color: #fff;
        border: none;
        padding: 15px 40px;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
    }

    .main-button:hover {
        background: #fff;
        color: #7453fc;
    }

    .modal-content {
        border-radius: 15px;
        overflow: hidden;
    }

    .modal-header {
        background: #7453fc;
        color: #fff;
        border-bottom: none;
    }

    .modal-title {
        margin: 0;
        font-size: 18px;
        font-weight: 500;
    }

    .btn-close {
        background: transparent;
        border: none;
        color: #fff;
        font-size: 24px;
        opacity: 0.7;
    }

    .btn-close:hover {
        opacity: 1;
    }

    .form-label {
        color: #fff;
        font-weight: 500;
    }

    .form-control {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        color: #fff;
    }

    .form-control:focus {
        background: rgba(255, 255, 255, 0.2);
        border-color: #7453fc;
        box-shadow: 0 0 5px rgba(116, 83, 252, 0.5);
    }

    .text-muted {
        color: rgba(255, 255, 255, 0.7) !important;
    }

    .payment-qr img {
        border-radius: 10px;
        margin-bottom: 10px;
    }
    </style>
    
    <script src="assets/js/payment-handler.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="assets/js/navigation.js"></script>

    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
