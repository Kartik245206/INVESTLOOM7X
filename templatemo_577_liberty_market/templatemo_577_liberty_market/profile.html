<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>User Profile - Liberty Market</title>
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-liberty-market.css">
    <link rel="stylesheet" href="assets/css/desktop-only.css">
    <link href="assets/css/utils/variables.css" rel="stylesheet">
    <link href="assets/css/navigation.css" rel="stylesheet">
    <link href="assets/css/components/modals.css" rel="stylesheet">
    <link href="assets/css/components/cards.css" rel="stylesheet">
    <link href="assets/css/components/forms.css" rel="stylesheet">
    <script src="common/footer-nav.html" defer></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="assets/js/common.js"></script>
    <style>
        /* Additional styles to fix layout issues */
        .profile-container {
            padding: 20px 15px;
        }
        .profile-card {
            margin-bottom: 20px;
            overflow: hidden;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    </head>
<body>
    <header class="main-nav">
        <a href="index.html" class="logo">
            <img src="assets/images/logo.png" alt="INVESTLOOM7X">
        </a>

        </header>

    <nav class="side-nav">
        <a href="index.html" class="nav-link active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="profile.html" class="nav-link">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
        <a href="details.html" class="nav-link">
            <i class="fas fa-info-circle"></i>
            <span>Details</span>
        </a>
        <a href="Host-WEB/admin_Login_page.html" class="nav-link">
            <i class="fas fa-user-shield"></i>
            <span>Admin</span>
        </a>
        <a href="login.html" class="nav-link">
            <i class="fas fa-sign-in-alt"></i>
            <span>Login</span>
        </a>
        <a href="signup.html" class="nav-link">
            <i class="fas fa-user-plus"></i>
            <span>Create Account</span>
        </a>
    </nav>
    <div class="side-nav-toggle" id="sideNavToggle">
            <i class="fas fa-arrow-right"></i>
        </div> 

    <div class="profile-container">
        <div class="container">
            <div class="row g-3">

                <!-- Profile Header -->
                <div class="col-12 col-lg-12">
                    <div class="profile-card">
                        <div class="profile-header" >
                            <div class="profile-pic">
                                <img id="userProfilePic" src="assets/images/default-avatar.png" alt="Profile Picture" class="img-fluid rounded-circle">
                                <div class="edit-pic" onclick="document.getElementById('profilePicInput').click()">
                                    <i class="fa fa-camera"></i>
                                </div>
                                <input type="file" id="profilePicInput" hidden accept="image/*" onchange="updateProfilePic(this)">
                            </div>
                            <div class="profile-info">
                                <h2 class="mb-2" id="username"></h2>
                                
                                <div class="profile-balance p-3 rounded">
                                    <div class="balance-title h5 mb-2">Total Balance</div>
                                    <div class="balance-amount h3 mb-2" id="totalBalanceDisplay">₹0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="col-6 col-md-3">
                    <div class="stats-card">
                        <h4 class="h6 mb-2">Current Balance</h4>
                        <h2 class="h4 mb-0" id="currentBalance">₹{userBalance}</h2>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stats-card">
                        <h4 class="h6 mb-2">Daily Earnings</h4>
                        <h2 class="h4 mb-0" id="dailyEarnings">₹0/day</h2>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stats-card">
                        <h4 class="h6 mb-2">Total Withdrawn</h4>
                        <h2 class="h4 mb-0" id="totalWithdrawn">₹0</h2>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stats-card">
                        <h4 class="h6 mb-2">Available for Withdrawal</h4>
                        <h2 class="h4 mb-0" id="availableForWithdrawal"></h2>
                        <small class="text-muted d-block mt-2">Min. withdrawal: ₹500</small>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-6 col-md-3">

                    <div class="profile-card">
                        <ul class="nav nav-pills mb-4" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="pill" href="#transactions">Transactions</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="pill" href="#banking">Banking Details</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="pill" href="#purchased"><i class="fas fa-shopping-bag"></i> My Products</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="pill" href="#settings"><i class="fas fa-cog"></i> Settings</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div id="transactions" class="tab-pane fade show active">
                                <div id="transactionList">
                                    <!-- Transactions will be loaded here -->
                                </div>
                                <button class="btn btn-primary mt-3" id="withdrawBtn" onclick="handleWithdrawal()">
                                    Withdraw Balance
                                </button>
                            </div>

                            <div id="banking" class="tab-pane fade">
                                <form id="bankDetailsForm" onsubmit="updateBankInfo(event)">
                                    <div class="mb-3">
                                        <label class="form-label">Account Number</label>
                                        <input type="text" class="form-control" id="accountNumber" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">IFSC Code</label>
                                        <input type="text" class="form-control" id="ifscCode" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Bank Name</label>
                                        <input type="text" class="form-control" id="bankName" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Bank Details</button>
                                </form>
                            </div>

                            <div id="purchased" class="tab-pane fade">
                                <h4 class="mb-4"><i class="fa fa-shopping-bag"></i> My Purchased Products</h4>
                                <div class="row" id="purchasedProductsList">
                                    <!-- Purchased products will be loaded here -->
                                    <div class="col-12 text-center" id="noPurchasesMessage">
                                        <p>You haven't purchased any products yet.</p>
                                        <a href="index.html" class="btn btn-primary">Browse Products</a>
                                    </div>
                                </div>
                            </div>

                            <div id="settings" class="tab-pane fade">
                                <h4 class="mb-4"><i class="fa fa-cog"></i> Account Settings</h4>
                                <form id="settingsForm" onsubmit="updateProfile(event)">
                                    <div class="mb-3">
                                        <label class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="fullName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">UPI ID</label>
                                        <input type="text" class="form-control" id="upiId" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Notification Preferences</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                            <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="smsNotifications">
                                            <label class="form-check-label" for="smsNotifications">SMS Notifications</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Theme Preference</label>
                                        <select class="form-select" id="themePreference">
                                            <option value="light">Light</option>
                                            <option value="dark">Dark</option>
                                            <option value="system">System Default</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Profile</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add this in your profile page where you show balance -->
                <div class="balance-section">
                    <h3>Your Balance</h3>
                    <h2 id="currentBalance">₹0.00</h2>
                    <button class="btn btn-primary" onclick="initiateWithdrawal()">Withdraw Funds</button>
                </div>

                <!-- Add this in your profile actions section -->
                <div class="profile-action-buttons">
                    <button class="btn btn-primary" onclick="showWithdrawModal()">
                        <i class="fas fa-money-bill-transfer"></i> Withdraw
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/common.js"></script>
    <script src="assets/js/auth.js"></script>
    <!-- Add this script at the end of the file -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            auth.initSession();
        });
    </script>

    <!-- Withdrawal Modal -->
    <div class="modal fade" id="withdrawalModal" tabindex="-1" aria-labelledby="withdrawalModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="withdrawalModalLabel">Withdraw Funds</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="withdrawalForm">
              <div class="mb-3">
                <label for="withdrawalAmount" class="form-label">Withdrawal Amount (₹)</label>
                <input type="number" class="form-control" id="withdrawalAmount" min="500" required>
                <small class="text-muted">Available Balance: <span id="withdrawalBalance">₹0</span></small>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Withdrawal Method</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="withdrawalMethod" id="methodBank" value="bank" checked>
                  <label class="form-check-label" for="methodBank">
                    Bank Transfer
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="withdrawalMethod" id="methodUPI" value="upi">
                  <label class="form-check-label" for="methodUPI">
                    UPI Transfer
                  </label>
                </div>
              </div>
              
              <div id="bankDetails">
                <div class="mb-3">
                  <label for="accountName" class="form-label">Account Holder Name</label>
                  <input type="text" class="form-control" id="accountName">
                </div>
                <div class="mb-3">
                  <label for="accountNumber" class="form-label">Account Number</label>
                  <input type="text" class="form-control" id="accountNumber">
                </div>
                <div class="mb-3">
                  <label for="ifscCode" class="form-label">IFSC Code</label>
                  <input type="text" class="form-control" id="ifscCode">
                </div>
              </div>
              
              <div id="upiDetails" style="display: none;">
                <div class="mb-3">
                  <label for="upiId" class="form-label">UPI ID</label>
                  <input type="text" class="form-control" id="upiId" placeholder="example@upi">
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="processWithdrawal()">Withdraw</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Toggle withdrawal method details
      document.querySelectorAll('input[name="withdrawalMethod"]').forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'bank') {
            document.getElementById('bankDetails').style.display = 'block';
            document.getElementById('upiDetails').style.display = 'none';
          } else {
            document.getElementById('bankDetails').style.display = 'none';
            document.getElementById('upiDetails').style.display = 'block';
          }
        });
      });
    </script>
    <script src="assets/js/navigation.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    
    if (currentUser) {
        // Show logged in user's data
        document.getElementById('username').textContent = currentUser.username;
        document.getElementById('userBalance').textContent = '₹' + (currentUser.balance || 0);
        if (currentUser.profilePic) {
            document.getElementById('profilePic').src = currentUser.profilePic;
        }
    } else {
        // Show guest view
        document.getElementById('username').textContent = 'Guest User';
        document.getElementById('userBalance').textContent = '₹0';
        document.getElementById('profilePic').src = 'assets/images/author.jpg';
        
        // Show login/signup buttons
        document.querySelector('.profile-actions').innerHTML = `
            <a href="login.html" class="btn btn-primary">Login</a>
            <a href="signup.html" class="btn btn-secondary">Sign Up</a>
        `;
        
        // Hide sensitive features
        document.querySelectorAll('.requires-auth').forEach(el => el.style.display = 'none');
    }
});


function updateUserData() {
  fetch('/api/users/profile', {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById('userBalance').textContent = `₹${data.balance}`;
    document.getElementById('dailyEarnings').textContent = `₹${data.dailyEarnings}/day`;
    document.getElementById('totalWithdrawn').textContent = `₹${data.totalWithdrawn}`;
    document.getElementById('availableForWithdrawal').textContent = `₹${data.availableForWithdrawal}`;
  });
}

// Update every minute
setInterval(updateUserData, 60000);
</script>

<script>
    // load [footer-nav.html](http://_vscodecontentref_/1) and insert it into the page (execute inline scripts)
    (function loadFooterNav() {
      fetch('common/footer-nav.html')
        .then(r => {
          if (!r.ok) throw new Error('HTTP ' + r.status);
          return r.text();
        })
        .then(html => {
          const container = document.createElement('div');
          container.innerHTML = html;

          // Move non-script nodes into body (append at end)
          const scripts = [];
          Array.from(container.childNodes).forEach(node => {
            if (node.tagName === 'SCRIPT') scripts.push(node);
            else document.body.appendChild(node);
          });

          // Recreate & run scripts (so inline scripts execute)
          scripts.forEach(oldScript => {
            const s = document.createElement('script');
            if (oldScript.src) s.src = oldScript.src;
            s.textContent = oldScript.textContent;
            // preserve async/defer attributes if present
            if (oldScript.async) s.async = true;
            if (oldScript.defer) s.defer = true;
            document.body.appendChild(s);
          });
        })
        .catch(err => console.error('Could not load footer-nav:', err));
    })();
    </script>
    <script>
    // Load and inject footer navigation
    fetch('common/footer-nav.html')
        .then(response => response.text())
        .then(html => {
            document.body.insertAdjacentHTML('beforeend', html);
        })
        .catch(err => console.error('Error loading footer nav:', err));
    </script>
</body>
</html>