<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>User Profile - Liberty Market</title>
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-liberty-market.css">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="assets/js/common.js"></script>
    <script src="assets/js/auth.js"></script>
</head>
<body>


    <div class="profile-container">
        <div class="container">
            <div class="row">
                <!-- Profile Header -->
                <div class="col-12">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-pic">
                                <img id="userProfilePic" src="assets/images/default-avatar.png" alt="Profile Picture">
                                <div class="edit-pic" onclick="document.getElementById('profilePicInput').click()">
                                    <i class="fa fa-camera"></i>
                                </div>
                                <input type="file" id="profilePicInput" hidden accept="image/*" onchange="updateProfilePic(this)">
                            </div>
                            <div class="profile-info">
                                <h2 href="signup.html">{username}</h2>

                                <p id="userEmail" class="text-muted">Loading...</p>
                                
                                <div class="profile-balance">
                                    <div class="balance-title">Total Balance</div>
                                    <div class="balance-amount" id="totalBalanceDisplay">₹0</div>
                                    <div class="withdrawal-available" id="withdrawalAvailable">Available for withdrawal: ₹0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="col-md-4">
                    <div class="stats-card">
                        <h4>Current Balance</h4>
                        <h2 id="currentBalance">₹{userBalance}</h2>

                        
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stats-card">
                        <h4>Daily Earnings</h4>
                        <h2 id="dailyEarnings">₹0/day</h2>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stats-card">
                        <h4>Total Withdrawn</h4>
                        <h2 id="totalWithdrawn">₹0</h2>
                    </div>
                </div>

                <!-- Add in balance section -->
                <div class="col-md-4">
                    <div class="stats-card">
                        <h4>Available for Withdrawal</h4>
                        <h2 id="availableForWithdrawal">₹0</h2>
                        <small class="text-muted">Min. withdrawal: ₹500</small>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-12 mt-4">
                    <div class="profile-card">
                        <ul class="nav nav-pills mb-4" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="pill" href="#transactions">Transactions</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="pill" href="#banking">Banking Details</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="pill" href="#purchased"><i class="fas fa-shopping-bag"></i> My Products</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="pill" href="#settings"><i class="fas fa-cog"></i> Settings</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div id="transactions" class="tab-pane fade show active">
                                <div id="transactionList">
                                    <!-- Transactions will be loaded here -->
                                </div>
                                <button class="btn btn-primary mt-3" id="withdrawBtn" onclick="handleWithdrawal()">
                                    Withdraw Balance
                                </button>
                            </div>

                            <div id="banking" class="tab-pane fade">
                                <form id="bankDetailsForm" onsubmit="updateBankInfo(event)">
                                    <div class="mb-3">
                                        <label class="form-label">Account Number</label>
                                        <input type="text" class="form-control" id="accountNumber" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">IFSC Code</label>
                                        <input type="text" class="form-control" id="ifscCode" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Bank Name</label>
                                        <input type="text" class="form-control" id="bankName" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Bank Details</button>
                                </form>
                            </div>

                            <div id="purchased" class="tab-pane fade">
                                <h4 class="mb-4"><i class="fa fa-shopping-bag"></i> My Purchased Products</h4>
                                <div class="row" id="purchasedProductsList">
                                    <!-- Purchased products will be loaded here -->
                                    <div class="col-12 text-center" id="noPurchasesMessage">
                                        <p>You haven't purchased any products yet.</p>
                                        <a href="index.html" class="btn btn-primary">Browse Products</a>
                                    </div>
                                </div>
                            </div>

                            <div id="settings" class="tab-pane fade">
                                <h4 class="mb-4"><i class="fa fa-cog"></i> Account Settings</h4>
                                <form id="settingsForm" onsubmit="updateProfile(event)">
                                    <div class="mb-3">
                                        <label class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="fullName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">UPI ID</label>
                                        <input type="text" class="form-control" id="upiId" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Notification Preferences</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                            <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="smsNotifications">
                                            <label class="form-check-label" for="smsNotifications">SMS Notifications</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Theme Preference</label>
                                        <select class="form-select" id="themePreference">
                                            <option value="light">Light</option>
                                            <option value="dark">Dark</option>
                                            <option value="system">System Default</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Profile</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add this in your profile page where you show balance -->
                <div class="balance-section">
                    <h3>Your Balance</h3>
                    <h2 id="currentBalance">₹0.00</h2>
                    <button class="btn btn-primary" onclick="initiateWithdrawal()">Withdraw Funds</button>
                </div>

                <!-- Add this in your profile actions section -->
                <div class="profile-action-buttons">
                    <button class="btn btn-primary" onclick="showWithdrawModal()">
                        <i class="fas fa-money-bill-transfer"></i> Withdraw
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/common.js"></script>
    <script src="assets/js/auth.js"></script>
    <!-- Add this script at the end of the file -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            auth.initSession();
        });
    </script>

    <!-- Withdrawal Modal -->
    <div class="modal fade" id="withdrawalModal" tabindex="-1" aria-labelledby="withdrawalModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="withdrawalModalLabel">Withdraw Funds</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="withdrawalForm">
              <div class="mb-3">
                <label for="withdrawalAmount" class="form-label">Withdrawal Amount (₹)</label>
                <input type="number" class="form-control" id="withdrawalAmount" min="500" required>
                <small class="text-muted">Available Balance: <span id="withdrawalBalance">₹0</span></small>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Withdrawal Method</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="withdrawalMethod" id="methodBank" value="bank" checked>
                  <label class="form-check-label" for="methodBank">
                    Bank Transfer
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="withdrawalMethod" id="methodUPI" value="upi">
                  <label class="form-check-label" for="methodUPI">
                    UPI Transfer
                  </label>
                </div>
              </div>
              
              <div id="bankDetails">
                <div class="mb-3">
                  <label for="accountName" class="form-label">Account Holder Name</label>
                  <input type="text" class="form-control" id="accountName">
                </div>
                <div class="mb-3">
                  <label for="accountNumber" class="form-label">Account Number</label>
                  <input type="text" class="form-control" id="accountNumber">
                </div>
                <div class="mb-3">
                  <label for="ifscCode" class="form-label">IFSC Code</label>
                  <input type="text" class="form-control" id="ifscCode">
                </div>
              </div>
              
              <div id="upiDetails" style="display: none;">
                <div class="mb-3">
                  <label for="upiId" class="form-label">UPI ID</label>
                  <input type="text" class="form-control" id="upiId" placeholder="example@upi">
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="processWithdrawal()">Withdraw</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Toggle withdrawal method details
      document.querySelectorAll('input[name="withdrawalMethod"]').forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'bank') {
            document.getElementById('bankDetails').style.display = 'block';
            document.getElementById('upiDetails').style.display = 'none';
          } else {
            document.getElementById('bankDetails').style.display = 'none';
            document.getElementById('upiDetails').style.display = 'block';
          }
        });
      });
    </script>
</body>
</html>